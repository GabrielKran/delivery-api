<div class="container py-5 fade-in">
  
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold mb-0"><i class="bi bi-cart-plus me-2 text-gold"></i>Novo Pedido</h2>
    <button class="btn btn-outline-secondary rounded-pill px-4" (click)="voltar()">Cancelar</button>
  </div>

  <form (ngSubmit)="salvarPedido()">
    <div class="row g-4">
      
      <div class="col-lg-7">
        
        <div class="card border-0 shadow-sm rounded-4 mb-4">
          <div class="card-body p-4">
            <h5 class="fw-bold mb-3">Dados do Cliente</h5>
            <div class="row g-3">
              <div class="col-md-7">
                <label class="form-label small text-muted">Nome Completo</label>
                <input type="text" class="form-control" [(ngModel)]="novoPedido.customer.name" name="cName" required placeholder="Ex: João da Silva">
              </div>
              <div class="col-md-5">
                <label class="form-label small text-muted">Telefone</label>
                <input type="text" class="form-control" [(ngModel)]="novoPedido.customer.temporary_phone" name="cPhone" placeholder="(XX) 99999-9999">
              </div>
            </div>
          </div>
        </div>

        <div class="card border-0 shadow-sm rounded-4 mb-4">
          <div class="card-body p-4">
            <h5 class="fw-bold mb-3">Endereço de Entrega e GPS</h5>
            <div class="row g-3">
              <div class="col-md-9">
                <label class="form-label small text-muted">Rua / Avenida</label>
                <input type="text" class="form-control" [(ngModel)]="novoPedido.delivery_address.street_name" name="street" required>
              </div>
              <div class="col-md-3">
                <label class="form-label small text-muted">Número</label>
                <input type="text" class="form-control" [(ngModel)]="novoPedido.delivery_address.street_number" name="number" required>
              </div>
              <div class="col-md-6">
                <label class="form-label small text-muted">Bairro</label>
                <input type="text" class="form-control" [(ngModel)]="novoPedido.delivery_address.neighborhood" name="neighborhood">
              </div>
              <div class="col-md-6">
                <label class="form-label small text-muted">Ponto de Referência</label>
                <input type="text" class="form-control" [(ngModel)]="novoPedido.delivery_address.reference" name="ref">
              </div>
              
              <div class="col-md-6">
                <label class="form-label small text-muted">Latitude (GPS)</label>
                <input type="number" class="form-control" [(ngModel)]="novoPedido.delivery_address.latitude" name="lat" step="any">
              </div>
              <div class="col-md-6">
                <label class="form-label small text-muted">Longitude (GPS)</label>
                <input type="number" class="form-control" [(ngModel)]="novoPedido.delivery_address.longitude" name="lng" step="any">
              </div>

            </div>
          </div>
        </div>

      </div>

      <div class="col-lg-5">
        
        <div class="card border-0 shadow-sm rounded-4 mb-4">
          <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h5 class="fw-bold mb-0">Itens do Pedido</h5>
              <button type="button" class="btn btn-sm btn-outline-dark rounded-pill" (click)="adicionarItem()">+ Item</button>
            </div>
            
            @for (item of novoPedido.items; track $index) {
              <div class="p-3 bg-light rounded-3 mb-3 position-relative border">
                @if (novoPedido.items.length > 1) {
                  <button type="button" class="btn-close position-absolute top-0 end-0 m-2" (click)="removerItem($index)"></button>
                }
                
                <div class="mb-2">
                  <label class="form-label small text-muted mb-0">Prato / Produto</label>
                  <input type="text" class="form-control form-control-sm" [(ngModel)]="item.name" name="itemName_{{$index}}" required placeholder="Ex: Camarão Internacional">
                </div>
                
                <div class="row g-2 mb-2">
                  <div class="col-6">
                    <label class="form-label small text-muted mb-0">Preço (R$)</label>
                    <input type="number" class="form-control form-control-sm" [(ngModel)]="item.price" name="itemPrice_{{$index}}" (change)="calcularTotal()" min="0">
                  </div>
                  <div class="col-6">
                    <label class="form-label small text-muted mb-0">Quantidade</label>
                    <input type="number" class="form-control form-control-sm" [(ngModel)]="item.quantity" name="itemQty_{{$index}}" (change)="calcularTotal()" min="1">
                  </div>
                </div>

                <div>
                  <input type="text" class="form-control form-control-sm" [(ngModel)]="item.observations" name="itemObs_{{$index}}" placeholder="Obs: Sem cebola">
                </div>
              </div>
            }
          </div>
        </div>

        <div class="card border-0 shadow-sm rounded-4 bg-gold text-white">
          <div class="card-body p-4">
            <h5 class="fw-bold mb-3 text-white border-bottom border-light pb-2">Pagamento e Fechamento</h5>
            
            <div class="mb-4">
              <label class="form-label small text-white-50">Forma de Pagamento</label>
              <select class="form-select form-select-sm" [(ngModel)]="novoPedido.payments[0].origin" name="paymentOrigin">
                <option value="CREDIT_CARD">Cartão de Crédito</option>
                <option value="DEBIT_CARD">Cartão de Débito</option>
                <option value="PIX">PIX</option>
                <option value="VR">Vale Refeição</option>
                <option value="CASH">Dinheiro</option>
              </select>
            </div>

            <div class="d-flex justify-content-between align-items-center mb-4">
              <span class="fs-5">Total a Pagar</span>
              <span class="fs-2 fw-bold">R$ {{ (novoPedido.total_price || 0).toFixed(2) }}</span>
            </div>

            <button type="submit" class="btn btn-light w-100 py-2 rounded-pill fw-bold text-dark shadow-sm" [disabled]="isSubmitting">
              {{ isSubmitting ? 'Gerando Pedido...' : 'Finalizar Pedido' }}
            </button>
          </div>
        </div>

      </div>
    </div>
  </form>
</div>